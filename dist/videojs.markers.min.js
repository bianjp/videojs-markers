"use strict";!function(e,r,i){function t(){var e=(new Date).getTime(),r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){var i=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==r?i:3&i|8).toString(16)});return r}function a(r){function i(){x.sort(function(e,r){return f.markerTip.time(e)-f.markerTip.time(r)})}function a(r){e.each(r,function(e,r){r.key=t();var i=m(r);if(y.find(".vjs-progress-control").prepend(i),f.markerTip.display){var a=i.find(".vjs-tip");a.css("left",-a.outerWidth()/2+i.width()/2+"px")}p[r.key]=r,x.push(r)}),i()}function o(e){return f.markerTip.time(e)/h.duration()*100}function m(r,i){var t=e('<div class="vjs-marker"><div class="marker"></div></div>');if(f.markerTip.display){var a='<div class="vjs-tip"><div class="vjs-tip-arrow"></div><div class="vjs-tip-inner">';r.image&&(a+='<img src="'+r.image+'">',r.text&&(a+="<br/>")),r.text&&(a+=r.text),a+="</div></div>",t.append(a)}return t.find(".marker"),t.css({"margin-left":-t.width()/2+"px",left:o(r)+"%"}).attr("data-marker-key",r.key).attr("data-marker-time",f.markerTip.time(r)),r["class"]&&t.addClass(r["class"]),t.on("click",function(i){var t=!1;if("function"==typeof f.onMarkerClick&&(t=0==f.onMarkerClick(r)),!t){var a=e(this).data("marker-key");h.currentTime(f.markerTip.time(p[a]))}}),t}function s(){for(var e=0;e<x.length;e++){var r=x[e],t=y.find('.vjs-marker[data-marker-key="'+r.key+'"]'),a=f.markerTip.time(r);t.data("marker-time")!=a&&t.css({left:o(r)+"%"}).attr("data-marker-time",a)}i()}function l(e){b&&(j=-1,b.css("visibility","hidden")),T=-1;for(var r=0;r<e.length;r++){var t=e[r],a=x[t];a&&(delete p[a.key],x[t]=null,y.find('.vjs-marker[data-marker-key="'+a.key+'"]').remove())}for(var r=x.length-1;r>=0;r--)null===x[r]&&x.splice(r,1);i()}function v(){if(f.breakOverlay.display&&!(0>T)){var e=h.currentTime(),r=x[T],i=f.markerTip.time(r);e>=i&&e<=i+f.breakOverlay.displayTime?(j!=T&&(j=T,b.find(".vjs-break-overlay-text").text(f.breakOverlay.text(r))),b.css("visibility","visible")):(j=-1,b.css("visibility","hidden"))}}function c(){b=e('<div class="vjs-break-overlay"><div class="vjs-break-overlay-text"></div></div>'),y.append(b),j=-1}function k(){d(),v()}function d(){var e=function(e){return e<x.length-1?f.markerTip.time(x[e+1]):h.duration()},i=h.currentTime(),t=-1;if(-1!=T){var a=e(T);if(i>=f.markerTip.time(x[T])&&a>i)return;if(T===x.length-1&&i===h.duration())return}if(x.length>0&&i<f.markerTip.time(x[0]))t=-1;else for(var n=0;n<x.length;n++)if(a=e(n),i>=f.markerTip.time(x[n])&&a>i){t=n;break}t!=T&&(-1!=t&&r.onMarkerReached&&r.onMarkerReached(x[t]),T=t)}function u(){h.markers.removeAll(),a(r.markers),f.breakOverlay.display&&c(),k(),h.on("timeupdate",k)}var f=e.extend(!0,{},n,r),p={},x=[],y=e(this.el()),T=-1,h=this,g=null,b=null,j=-1;h.on("loadedmetadata",function(){u()}),h.markers={getMarkers:function(){return x},next:function(){for(var e=h.currentTime(),r=0;r<x.length;r++){var i=f.markerTip.time(x[r]);if(i>e){h.currentTime(i);break}}},prev:function(){for(var e=h.currentTime(),r=x.length-1;r>=0;r--){var i=f.markerTip.time(x[r]);if(e>i+.5){h.currentTime(i);break}}},add:function(e){a(e)},remove:function(e){l(e)},removeAll:function(){for(var e=[],r=0;r<x.length;r++)e.push(r);l(e)},updateTime:function(){s()},reset:function(e){h.markers.removeAll(),a(e)},destroy:function(){h.markers.removeAll(),b.remove(),g.remove(),h.off("timeupdate",v),delete h.markers}}}var n={markerTip:{display:!0,time:function(e){return e.time}},breakOverlay:{display:!1,displayTime:3,text:function(e){return"Break overlay: "+e.overlayText}},onMarkerClick:function(e){},onMarkerReached:function(e){},markers:[]};r.plugin("markers",a)}(jQuery,window.videojs);